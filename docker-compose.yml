version: '3.8'

services:
  # Production Interview Instance 1
  # IMPORTANT: Before first run: chmod 777 sessions/
  echobox-prod-1:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        TARGETARCH: arm64
    container_name: echobox-prod-1
    ports:
      - "6780:8080"
    volumes:
      - ./sessions:/output
      - ./tasks:/tasks:ro
    environment:
      CANDIDATE_NAME: ${CANDIDATE_1:-candidate-1}
      SESSION_TIMEOUT: ${SESSION_TIMEOUT:-7200}
      LOG_LEVEL: info
      OUTPUT_DIR: /output
    mem_limit: 512m
    mem_reservation: 256m
    cpus: 0.5
    security_opt:
      - no-new-privileges:true
    restart: "no"
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=100m

  # Production Interview Instance 2
  echobox-prod-2:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        TARGETARCH: arm64
    container_name: echobox-prod-2
    ports:
      - "6781:8080"
    volumes:
      - ./sessions:/output
      - ./tasks:/tasks:ro
    environment:
      CANDIDATE_NAME: ${CANDIDATE_2:-candidate-2}
      SESSION_TIMEOUT: ${SESSION_TIMEOUT:-7200}
      LOG_LEVEL: info
      OUTPUT_DIR: /output
    mem_limit: 512m
    mem_reservation: 256m
    cpus: 0.5
    security_opt:
      - no-new-privileges:true
    restart: "no"
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=100m

  # Production Interview Instance 3
  echobox-prod-3:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        TARGETARCH: arm64
    container_name: echobox-prod-3
    ports:
      - "6782:8080"
    volumes:
      - ./sessions:/output
      - ./tasks:/tasks:ro
    environment:
      CANDIDATE_NAME: ${CANDIDATE_3:-candidate-3}
      SESSION_TIMEOUT: ${SESSION_TIMEOUT:-7200}
      LOG_LEVEL: info
      OUTPUT_DIR: /output
    mem_limit: 512m
    mem_reservation: 256m
    cpus: 0.5
    security_opt:
      - no-new-privileges:true
    restart: "no"
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=100m

  # Production Interview Instance 4
  echobox-prod-4:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        TARGETARCH: arm64
    container_name: echobox-prod-4
    ports:
      - "6783:8080"
    volumes:
      - ./sessions:/output
      - ./tasks:/tasks:ro
    environment:
      CANDIDATE_NAME: ${CANDIDATE_4:-candidate-4}
      SESSION_TIMEOUT: ${SESSION_TIMEOUT:-7200}
      LOG_LEVEL: info
      OUTPUT_DIR: /output
    mem_limit: 512m
    mem_reservation: 256m
    cpus: 0.5
    security_opt:
      - no-new-privileges:true
    restart: "no"
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=100m

  # Production Interview Instance 5
  echobox-prod-5:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        TARGETARCH: arm64
    container_name: echobox-prod-5
    ports:
      - "6784:8080"
    volumes:
      - ./sessions:/output
      - ./tasks:/tasks:ro
    environment:
      CANDIDATE_NAME: ${CANDIDATE_5:-candidate-5}
      SESSION_TIMEOUT: ${SESSION_TIMEOUT:-7200}
      LOG_LEVEL: info
      OUTPUT_DIR: /output
    mem_limit: 512m
    mem_reservation: 256m
    cpus: 0.5
    security_opt:
      - no-new-privileges:true
    restart: "no"
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=100m

# Named volumes for persistence
volumes:
  sessions:
    driver: local
  tasks:
    driver: local
